<!DOCTYPE html>
<html>
  <head>
    <title>Exchange Distribution Locations</title>

    <!-- Load Locations -->
    <script src="EWARoutes.js"></script>

    <script>
 function getMarkerIcon(edition) {
  const editionColors = {
    EWA: "green",
    LCV: "yellow",
    WML: "blue",
    NID: "red"
  };

  if (!edition || typeof edition !== "string") {
    console.warn("Edition is missing or invalid:", edition);
    return {
      url: "http://maps.google.com/mapfiles/ms/icons/white-dot.png",
      scaledSize: new google.maps.Size(32, 32)
    };
  }

  const editions = edition
    .split(",")
    .map(e => e.trim())
    .filter(e => e.length > 0);

  if (editions.length === 1 && editionColors[editions[0]]) {
    return {
      url: `http://maps.google.com/mapfiles/ms/icons/${editionColors[editions[0]]}-dot.png`,
      scaledSize: new google.maps.Size(32, 32)
    };
  }

  // Multi-edition â€” use your custom icon scaled
  return {
    url: "multiEdition.png",
    scaledSize: new google.maps.Size(32, 32)
  };
}


      function initMap() {
        const map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 47.65, lng: -117.42 },
          zoom: 11
        });

        console.log("Checking for multi-edition stops:");
        const multiEditionStops = locations.filter(loc => {
          if (!loc.edition) return false;
          const editions = loc.edition
            .split(",")
            .map(e => e.trim())
            .filter(e => e.length > 0);
          return editions.length > 1;
        });
        console.log("Multi-edition Stops:", multiEditionStops);

        locations.forEach(({ lat, lng, placeId, route, edition, notes, address, locationName }) => {
          const marker = new google.maps.Marker({
            position: { lat: parseFloat(lat), lng: parseFloat(lng) },
            map,
            title: locationName,
            icon: getMarkerIcon(edition)
          });

          const infoWindow = new google.maps.InfoWindow({
            content: `
              <div style="max-width: 250px;">
                <h3>${locationName}</h3>
                <p><strong>Route:</strong> ${route}</p>
                <p><strong>Address:</strong> ${address}</p>
                <p><strong>Edition:</strong> ${edition}</p>
                <p><strong>Notes:</strong> ${notes}</p>
                <p><a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}" target="_blank">View on Google Maps</a></p>
              </div>
            `
          });

          marker.addListener("click", () => {
            infoWindow.open(map, marker);
          });
        });
      }
    </script>

    <!-- Load Google Maps last -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBBWFsbxlhDL-eEODcF1X9oheYWopr3uAg&callback=initMap"
      async
      defer
    ></script>
    <style>
  #legend {
    background: white;
    padding: 10px;
    margin: 10px;
    font-size: 14px;
    font-family: Arial, sans-serif;
    border: 1px solid #ccc;
    position: absolute;
    bottom: 30px;
    left: 30px;
    z-index: 5;
  }
  #legend img {
    vertical-align: middle;
    margin-right: 6px;
  }
</style>

  </head>

  <body>
    <div id="map" style="height: 100vh; width: 100%"></div>
    <div id="legend">
  <h3>Legend</h3>
  <p><img src="http://maps.google.com/mapfiles/ms/icons/green-dot.png"> EWA</p>
  <p><img src="http://maps.google.com/mapfiles/ms/icons/yellow-dot.png"> LCV</p>
  <p><img src="http://maps.google.com/mapfiles/ms/icons/red-dot.png"> NID</p>
  <p><img src="http://maps.google.com/mapfiles/ms/icons/blue-dot.png"> WML</p>
  <p><img src="multiEdition.png" style="width: 20px; height: 20px;"> Multiple Editions</p>
</div>

  </body>
</html>
